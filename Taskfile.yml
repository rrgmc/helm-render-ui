version: '3'

tasks:
  doc:
    cmds:
      - 'go doc -http'
  install:
    cmds:
      - 'go install github.com/rrgmc/helm-render-ui'
  test:
    cmds:
      - 'go test ./...'
  dev-ui:
    dir: './ui'
    cmds:
      - 'npm start'
  init-ui:
    dir: './ui'
    cmds:
      - 'npm update'
  build-ui:
    dir: './ui'
    cmds:
      - 'npm run build'
      - 'npm run zip'
  current-version:
    cmds:
      - 'echo "Version: {{.GIT_TAG_CURRENT}}"'
    silent: true
    vars:
      GIT_TAG_CURRENT:
        sh: 'git describe --tags --abbrev=0'
  release-version:
    cmds:
      - 'echo "Version: {{.GIT_TAG_CURRENT}} => {{.VERSION}}"'
      - task: release-version-internal
    vars:
      GIT_TAG_CURRENT:
        sh: 'git describe --tags --abbrev=0'
    requires:
      vars: [VERSION]
    preconditions:
      - sh: 'test -z "$(git status --porcelain)"'
        msg: 'there are uncommited git changes'
    silent: true
  release-version-internal:
    internal: true
    prompt: "Creating and pushing tag {{.VERSION}}. Are you sure?"
    cmds:
      - 'git tag {{.VERSION}}'
      - 'git push --tags'
    requires:
      vars: [VERSION]
